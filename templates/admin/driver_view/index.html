<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quan SÃ¡t - {{ driver.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/driver_view.css') }}">
</head>

<body>
    <div class="container">
        <div class="header-compact">
            <div class="back-button">
                <a href="/" class="btn-back">â† Quay láº¡i</a>
            </div>
            <div class="header-info">
                <div class="driver-header-with-edit">
                    <h2 class="driver-name">ğŸš— {{ driver.name }}</h2>
                    <a href="/edit-driver/{{ driver.id }}" class="btn-overlay btn-secondary">
                        âœï¸
                    </a>
                </div>
                <p class="driver-subtitle">GiÃ¡m sÃ¡t video trá»±c tiáº¿p</p>

            </div>
            <div class="status-section">
                <span class="status-badge status-{{ driver.status }}">
                    {{ 'â— Äang hoáº¡t Ä‘á»™ng' if driver.status == 'active' else 'â— KhÃ´ng hoáº¡t Ä‘á»™ng' }}
                </span>
            </div>
        </div>

        <div class="info-bar">
            <div class="info-item">
                <span class="info-icon">ğŸ‘¨â€âœˆï¸</span>
                <span class="info-text">
                    <strong>TÃªn tÃ i xáº¿:</strong><br>
                    {{ driver.name }}
                </span>
            </div>
            <div class="info-item">
                <span class="info-icon">ğŸ«</span>
                <span class="info-text">
                    <strong>Báº±ng lÃ¡i:</strong><br>
                    {{ driver.license }}
                </span>
            </div>
            <div class="info-item">
                <span class="info-icon">ğŸ“</span>
                <span class="info-text">
                    <strong>Sá»‘ Ä‘iá»‡n thoáº¡i:</strong><br>
                    {{ driver.phone }}
                </span>
            </div>
            <div class="info-item">
                <span class="info-icon">ğŸ“¡</span>
                <span class="info-text">
                    <strong>Stream URL:</strong><br>
                    {{ driver.stream_url }}
                </span>
            </div>
        </div>

        <div class="video-section">
            <div class="video-container">
                <img id="videoStream" src="{{ driver.stream_url }}?t={{ timestamp }}" alt="Video Stream"
                    data-base-url="{{ driver.stream_url }}" onerror="handleStreamError()">
                <div id="loadingOverlay" class="loading-overlay">
                    <div class="spinner"></div>
                </div>
                <div id="flashOverlay" class="flash-overlay"></div>
                <div id="errorMessage" class="error-message" style="display: none;">
                    âš ï¸ KhÃ´ng thá»ƒ káº¿t ná»‘i camera
                </div>

                <!-- Video Controls Inside Container -->
                <div class="video-controls-overlay">
                    <button onclick="takeScreenshot()" class="btn-overlay btn-primary">
                        ğŸ“¸ Chá»¥p áº£nh
                    </button>
                    <button onclick="refreshStream()" class="btn-overlay btn-secondary">
                        ğŸ”„ LÃ m má»›i
                    </button>
                </div>
            </div>
        </div>

        <div class="gallery-section">
            <div class="gallery-header">
                <h2>ğŸ“· áº¢nh Ä‘Ã£ chá»¥p (<span id="photoCount">0</span>)</h2>
                <button onclick="clearGallery()" class="btn btn-danger" id="clearBtn" style="display: none;">
                    ğŸ—‘ï¸ XÃ³a táº¥t cáº£
                </button>
            </div>
            <div id="gallery" class="gallery-grid"></div>
        </div>
    </div>

    <script>
        // Pass data to module
        window.DRIVER_ID = {{ driver.id }};
        window.SNAPSHOT_URL = '{{ driver.stream_url }}'.replace('/video_feed/', '/snapshot/');
    </script>
    <script type="module" src="{{ url_for('static', filename='js/driver_view_module.js') }}"></script>
</body>

</html>